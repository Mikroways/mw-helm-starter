# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Test PersistentVolumeClaim
templates:
  - pvc.yaml
tests:
  - it: Should have no pvc created when persistence is disabled
    asserts:
      - hasDocuments:
          count: 0
  - it: Should have no pvc created when using extra volumes
    values:
      - values/persistence_extra_mounts.yaml
    asserts:
      - hasDocuments:
          count: 0
  - it: Should render one pvc when persistence is enabled in one container
    values:
      - values/persistence.yaml
    release:
      name: my-release
    set:
      nameOverride: myapp
    documentIndex: 0
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: PersistentVolumeClaim
      - equal:
          path: metadata.name
          value: data-my-release-myapp
      - equal:
          path: metadata.annotations["example.com/annotation"]
          value: "true"
