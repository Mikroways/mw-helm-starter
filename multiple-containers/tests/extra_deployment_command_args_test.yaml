# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Test Extra Deployment command and args
templates:
  - deployment.yaml
  - extra_deployment.yaml
  - configmap.yaml
  - secret.yaml
tests:
  - it: Should have one deployment
    template: deployment.yaml
    asserts:
      - hasDocuments:
          count: 1 # because original deployment is created
  - it: Should have no extra deployment
    template: extra_deployment.yaml
    asserts:
      - hasDocuments:
          count: 0 # because original deployment is created
  - it: Should have one extra deployment
    values:
      - values/extra_deployment_container_command_args_envs.yaml
    release:
      name: my-release
    chart:
      appVersion: 10.100.1000
    set:
      nameOverride: myapp
    template: extra_deployment.yaml
    documentSelector:
      path: metadata.name
      values: deployment-one-my-release-myapp
    asserts:
      - hasDocuments:
          count: 1
      - notExists:
          path: spec.template.spec.containers[0].command
      - notExists:
          path: spec.template.spec.containers[0].args
  - it: Should have command
  #   template: deployment.yaml
  #   values:
  #     - values/container_command_args_envs.yaml
  #   set:
  #     fullnameOverride: fullname
  #   asserts:
  #     - equal:
  #         path: spec.template.spec.containers[3].name
  #         value: container_with_command
  #     - exists:
  #         path: spec.template.spec.containers[3].command
  #     - equal:
  #         path: spec.template.spec.containers[3].command
  #         value:
  #           - /bin/sh
  #           - -c
  #           - |
  #             echo "Starting application..."
  #             exec my-app
  # - it: Should have args  
  #   template: deployment.yaml
  #   values:
  #     - values/container_command_args_envs.yaml
  #   set:
  #     fullnameOverride: fullname
  #   asserts:
  #     - equal:
  #         path: spec.template.spec.containers[2].name
  #         value: container_with_args
  #     - exists:
  #         path: spec.template.spec.containers[2].args
  #     - equal:
  #         path: spec.template.spec.containers[2].args
  #         value:
  #           - --config
  #           - /etc/myapp/config.yaml  
  #           - --verbose 
